<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Retro Solitaire</title>
<style>
    body {
        background: #2b2b2b;
        font-family: "Press Start 2P", monospace;
        color: #fff;
        display: flex;
        flex-direction: column;
        align-items: center;
        user-select: none;
        margin:0;
        padding:0;
        overflow-x: hidden;
    }
    h1 { margin: 10px; text-align:center; }
    #reset { 
        margin: 10px; 
        padding: 10px; 
        font-family: monospace; 
        font-size: 12px; 
        cursor: pointer; 
        z-index:1000; 
        position: relative;
    }
    #game { 
        display: flex; 
        flex-direction: column; 
        gap: 20px; 
        position: relative; 
        z-index:1; 
        max-width: 100vw;
    }
    #top-row { 
        display: flex; 
        gap: 10px; 
        width: 100%; 
        justify-content: space-between;
    }
    #foundations { 
        display: flex; 
        gap: 10px; 
    }
    #tableau {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 20px;
        width: 100%;
        justify-items: center;
    }
    .pile { 
        width: 80px; 
        height: 120px; 
        position: relative; 
    }
    .pile img { 
        width: 100%; 
        height: 100%; 
        position: absolute; 
        top: 0; 
        left: 0; 
        transition: top 0.2s, left 0.2s; 
    }
    .card { 
        cursor: grab; 
        z-index: 1; 
        touch-action: none; 
    }

    /* ðŸ“± Mobile adjustments */
    @media (max-width: 600px) {
        h1 { font-size: 12px; }
        .pile { width: 100px; height: 150px; }
        #top-row { 
            flex-direction: column; 
            align-items: center; 
            gap: 20px;
        }
        #tableau {
            grid-template-columns: repeat(4, 1fr);
            gap: 30px 20px; /* extra vertical spacing */
            justify-items: center;
        }
        #tableau .pile:nth-child(n+5) {
            grid-column: span 1;
        }
    }
</style>
</head>
<body>

<h1>Retro Solitaire</h1>
<button id="reset">RESET</button>
<div id="game">
    <div id="top-row">
        <div class="pile" id="stock"><img src="assets/back_blue.png"></div>
        <div class="pile" id="waste"><img src="assets/slot_waste.png"></div>
        <div id="foundations">
            <div class="pile" id="foundation0"><img src="assets/slot_foundation.png"></div>
            <div class="pile" id="foundation1"><img src="assets/slot_foundation.png"></div>
            <div class="pile" id="foundation2"><img src="assets/slot_foundation.png"></div>
            <div class="pile" id="foundation3"><img src="assets/slot_foundation.png"></div>
        </div>
    </div>
    <div id="tableau">
        <div class="pile" id="tableau0"><img src="assets/slot.png"></div>
        <div class="pile" id="tableau1"><img src="assets/slot.png"></div>
        <div class="pile" id="tableau2"><img src="assets/slot.png"></div>
        <div class="pile" id="tableau3"><img src="assets/slot.png"></div>
        <div class="pile" id="tableau4"><img src="assets/slot.png"></div>
        <div class="pile" id="tableau5"><img src="assets/slot.png"></div>
        <div class="pile" id="tableau6"><img src="assets/slot.png"></div>
    </div>
</div>

<script>
const suits = ["cuori","picche","fiori","quadri"];
const ranks = Array.from({length:13}, (_,i)=>String(i+1).padStart(2,'0'));
let deck = [];

function createDeck() {
    deck = [];
    for (let suit of suits) {
        for (let rank of ranks) {
            deck.push({rank, suit, img: `assets/${rank}${suit}.png`});
        }
    }
    shuffle(deck);
}

function shuffle(array) {
    for (let i = array.length-1; i>0; i--) {
        const j = Math.floor(Math.random()*(i+1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}

let stock=[], waste=[], foundations=[[],[],[],[]], tableau=[[],[],[],[],[],[],[]];

function deal() {
    tableau = [[],[],[],[],[],[],[]];
    foundations = [[],[],[],[]];
    waste = [];
    stock = [...deck];
    for (let i=0;i<7;i++) {
        for (let j=0;j<=i;j++) {
            let card = stock.pop();
            tableau[i].push({...card, faceUp: j===i});
        }
    }
    updateUI();
}

function updateUI() {
    // Tableau
    for (let i=0;i<7;i++) {
        const pileEl = document.getElementById('tableau'+i);
        pileEl.innerHTML = '';
        if(tableau[i].length===0){
            pileEl.innerHTML = `<img src="assets/slot.png">`;
        } else {
            tableau[i].forEach((c,index)=>{
                const img = document.createElement('img');
                img.src = c.faceUp ? c.img : 'assets/back_blue.png';
                img.classList.add('card');
                img.style.top = (index*20)+'px';
                img.draggable = c.faceUp;
                img.dataset.source = 'tableau';
                img.dataset.tIndex = i;
                img.dataset.cIndex = index;
                addDragHandlers(img);
                pileEl.appendChild(img);
            });
        }
    }

    // Stock
    const stockEl = document.getElementById('stock');
    stockEl.innerHTML = `<img src="${stock.length>0?'assets/back_blue.png':'assets/slot.png'}">`;

    // Waste
    const wasteEl = document.getElementById('waste');
    wasteEl.innerHTML = waste.length>0 
        ? `<img src="${waste[waste.length-1].img}" draggable="true" id="wasteCard" class="card">` 
        : `<img src="assets/slot_waste.png">`;

    if(waste.length>0){
        const wasteCard = document.getElementById('wasteCard');
        wasteCard.dataset.source = 'waste';
        wasteCard.dataset.cIndex = waste.length-1;
        addDragHandlers(wasteCard);
    }

    // Foundations
    for(let i=0;i<4;i++){
        const fEl = document.getElementById('foundation'+i);
        fEl.innerHTML = foundations[i].length>0 ? `<img src="${foundations[i][foundations[i].length-1].img}">` : `<img src="assets/slot_foundation.png">`;
        fEl.addEventListener('dragover', e=>e.preventDefault());
        fEl.addEventListener('drop', ()=>dropOnFoundation(i));
    }

    // Tableau drop
    for(let i=0;i<7;i++){
        const tEl = document.getElementById('tableau'+i);
        tEl.addEventListener('dragover', e=>e.preventDefault());
        tEl.addEventListener('drop', ()=>dropOnTableau(i));
    }
}

// Drag & drop (desktop + mobile)
let dragged = null;
let ghost = null;

function addDragHandlers(img){
    img.addEventListener('dragstart', dragStart);
    img.addEventListener('touchstart', touchStart, {passive:false});
}

function dragStart(e){
    setDragged(e.target);
    // Prevent default browser ghost
    e.dataTransfer.setDragImage(new Image(), 0, 0);
}

function touchStart(e){
    e.preventDefault();
    setDragged(e.target);
    // Create our custom ghost only for touch
    ghost = e.target.cloneNode(true);
    ghost.style.opacity = "0.7";
    ghost.style.position = "fixed";
    ghost.style.pointerEvents = "none";
    ghost.style.zIndex = "9999";
    document.body.appendChild(ghost);

    document.addEventListener('touchmove', touchMove, {passive:false});
    document.addEventListener('touchend', touchEnd);
}

function setDragged(el){
    const source = el.dataset.source;
    if(source==='tableau'){
        dragged = {source:'tableau', tIndex: parseInt(el.dataset.tIndex), cIndex: parseInt(el.dataset.cIndex)};
    } else if(source==='waste'){
        dragged = {source:'waste', cIndex: parseInt(el.dataset.cIndex)};
    }
}

function touchMove(e){
    if(ghost){
        const touch = e.touches[0];
        ghost.style.left = (touch.clientX-40)+"px";
        ghost.style.top = (touch.clientY-60)+"px";
    }
}

function touchEnd(e){
    if(ghost){
        ghost.remove();
        ghost=null;
    }
    const touch = e.changedTouches[0];
    const target = document.elementFromPoint(touch.clientX, touch.clientY);
    if(!target){ dragged=null; return; }
    if(target.closest('#foundations .pile')){
        const id = target.closest('.pile').id.replace("foundation","");
        dropOnFoundation(parseInt(id));
    } else if(target.closest('#tableau .pile')){
        const id = target.closest('.pile').id.replace("tableau","");
        dropOnTableau(parseInt(id));
    }
    dragged=null;
    document.removeEventListener('touchmove', touchMove);
    document.removeEventListener('touchend', touchEnd);
}

function dropOnFoundation(fIndex){
    if(!dragged) return;
    let card;
    if(dragged.source==='tableau'){
        card = tableau[dragged.tIndex][dragged.cIndex];
    } else if(dragged.source==='waste'){
        card = waste[dragged.cIndex];
    }
    const top = foundations[fIndex][foundations[fIndex].length-1];
    if((!top && card.rank==='01') || (top && top.suit===card.suit && parseInt(card.rank)===parseInt(top.rank)+1)){
        foundations[fIndex].push(card);
        if(dragged.source==='tableau'){
            tableau[dragged.tIndex].splice(dragged.cIndex);
            if(tableau[dragged.tIndex].length>0) tableau[dragged.tIndex][tableau[dragged.tIndex].length-1].faceUp = true;
        } else if(dragged.source==='waste'){
            waste.splice(dragged.cIndex,1);
        }
        updateUI();
    }
    dragged=null;
}

function dropOnTableau(tIndex){
    if(!dragged) return;
    let movingCards;
    if(dragged.source==='tableau'){
        movingCards = tableau[dragged.tIndex].slice(dragged.cIndex);
    } else if(dragged.source==='waste'){
        movingCards = [waste[dragged.cIndex]];
    }

    const destPile = tableau[tIndex];
    const topCard = destPile[destPile.length-1];
    const movingCard = movingCards[0];
    const isRed = c => c.suit==='cuori' || c.suit==='quadri';
    if((!topCard && movingCard.rank==='13') || (topCard && parseInt(topCard.rank)===parseInt(movingCard.rank)+1 && isRed(topCard)!==isRed(movingCard))){
        destPile.push(...movingCards);
        if(dragged.source==='tableau'){
            tableau[dragged.tIndex].splice(dragged.cIndex);
            if(tableau[dragged.tIndex].length>0) tableau[dragged.tIndex][tableau[dragged.tIndex].length-1].faceUp = true;
        } else if(dragged.source==='waste'){
            waste.splice(dragged.cIndex,1);
        }
        updateUI();
    }
    dragged=null;
}

// Stock click
document.getElementById('stock').addEventListener('click', ()=>{
    if(stock.length>0) {
        const card = stock.pop();
        card.faceUp = true;
        waste.push(card);
    } else {
        stock = waste.splice(0).reverse();
        stock.forEach(c=>c.faceUp=false);
    }
    updateUI();
});

// Reset
document.getElementById('reset').addEventListener('click', ()=>{
    createDeck();
    deal();
});

createDeck();
deal();
</script>

</body>
</html>

</html>


